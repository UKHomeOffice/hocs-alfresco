<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" xmlns:tns="http://www.activiti.org/test" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://www.activiti.org/test">
  <process id="foi_process" name="FOI process" isExecutable="true" isClosed="false" processType="None">
    <startEvent id="startevent1" name="Start" activiti:formKey="wf:submitGroupReviewTask"></startEvent>
    <sequenceFlow id="start" name="Start" sourceRef="startevent1" targetRef="CreateCaseTask"></sequenceFlow>
    <userTask id="CreateCaseTask" name="CreateCase" activiti:formKey="wf:adhocTask">
      <extensionElements>
        <activiti:taskListener event="create" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[logger.log("Starting workflow for new nodes in new FOI:");
              task.setVariableLocal('bpm_outcomePropertyName',qn.getQname('{http://cts-beta.homeoffice.gov.uk/model/content/1.0}draftResponse'));
	          execution.setVariable('bpm_outcomePropertyName',qn.getQname('{http://cts-beta.homeoffice.gov.uk/model/content/1.0}draftResponse'));
              for (var i = 0; i < bpm_package.children.length; i++) {
                    logger.log("Starting workflow for new node:" + bpm_package.children[i].nodeRef);
                    bpm_package.children[i].properties['cts:caseStatus'] = 'New';
                    if(execution.getVariable('cts_misallocated_case') != null) {
                     bpm_package.children[i].properties['cts:caseTask'] = 'Misallocated';
                    } else {
                     bpm_package.children[i].properties['cts:caseTask'] = 'Create case';
                    }
                    bpm_package.children[i].properties['cts:caseWorkflowStatus'] = '{"transitions":[{"label":"Reallocate","value":"Reallocate","manualAllocate":true,"allocateHeader":"Reallocate","colour":"green"},{"label":"Allocate for draft","value":"Next","manualAllocate":true,"allocateHeader":"Allocate for drafting","colour":"green"}],"mandatoryFields":[{"name":"channel","message":"Original channel in the Case details section must be populated"},{"name":"correspondentEmail","message":"Email address in the Requestor details must be populated","expression":"notBlank(case.correspondentEmail) or case.channel !== \'Email\'"},{"name":"correspondentAddressLine1","message":"Address in the Requestor details must be populated","expression":"notBlank(case.correspondentAddressLine1) or case.channel !== \'Post\'"},{"name":"correspondentPostcode","message":"Postcode in the Requestor details must be populated","expression":"notBlank(case.correspondentPostcode) or case.channel !== \'Post\'"},{"name":"correspondentSurname","message":"Last name in the Requestor details section must be populated"},{"name":"markupUnit","message":"Answering Unit in the Markup section must be populated","expression":"notBlank(case.markupUnit) or case.markupDecision === \'No reply needed\' or case.markupDecision ===\'Refer to DCU\'"},{"name":"markupTopic","message":"Topic in the markup section must be populated","expression":"notBlank(case.markupTopic) or case.markupDecision === \'No reply needed\' or case.markupDecision ===\'Refer to DCU\'"}]}';
                    bpm_package.children[i].save();
                }]]></activiti:string>
          </activiti:field>
        </activiti:taskListener>
        <activiti:taskListener event="complete" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[for (var i = 0; i < bpm_package.children.length; i++) {
               if (bpm_package.children[i].properties['cts:markupDecision'] == 'No reply needed') {
                   logger.log("Send initial case for NRR");
                   execution.setVariable('bpm_outcome', 'CreateCaseToNRR');
                   execution.setVariable('cts_nrr_original_status', 'CreateCase');
                   execution.setVariable('cts_nrr_original_create_case_unit', bpm_package.children[i].properties['cts:assignedUnit']);
                   execution.setVariable('cts_nrr_original_create_case_team', bpm_package.children[i].properties['cts:assignedTeam']);
                   execution.setVariable('cts_nrr_original_create_case_user', bpm_package.children[i].properties['cts:assignedUser']);
               } else if (bpm_package.children[i].properties['cts:markupDecision'] == 'Refer to DCU' ||
            	   bpm_package.children[i].properties['cts:markupDecision'] == 'Request unclear') {
  	               logger.log("Send initial case to complete");
                   execution.setVariable('bpm_outcome', 'CreateCaseToComplete');
               } else{
                   logger.log("Send initial case for initial draft");
                   execution.setVariable('bpm_outcome', 'SendCreateCaseForInitialDraft');
               }
           }]]></activiti:string>
          </activiti:field>
        </activiti:taskListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow3" sourceRef="CreateCaseTask" targetRef="exclusivegateway1"></sequenceFlow>
    <exclusiveGateway id="exclusivegateway1" name="Exclusive Gateway" default="AllocateForDraft"></exclusiveGateway>
    <sequenceFlow id="CreateCaseToNRR" name="Create Case To No response required" sourceRef="exclusivegateway1" targetRef="NRR">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${(bpm_outcome == 'CreateCaseToNRR')}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="CreateCaseToComplete" sourceRef="exclusivegateway1" targetRef="completeWorkflowScript">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${(bpm_outcome == 'CreateCaseToComplete')}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="AllocateForDraft" name="AllocateForDraft" sourceRef="exclusivegateway1" targetRef="InitialDraftTask"></sequenceFlow>
    <userTask id="InitialDraftTask" name="InitialDraft" activiti:formKey="wf:activitiReviewTask">
      <extensionElements>
        <activiti:taskListener event="create" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
          <activiti:field name="runAs">
            <activiti:string><![CDATA[admin]]></activiti:string>
          </activiti:field>
          <activiti:field name="script">
            <activiti:string><![CDATA[logger.log("Sending node to Draft in new FOI");
              task.setVariableLocal('bpm_outcomePropertyName',qn.getQname('{http://cts-beta.homeoffice.gov.uk/model/content/1.0}draftResponse'));
                execution.setVariable('bpm_outcomePropertyName',qn.getQname('{http://cts-beta.homeoffice.gov.uk/model/content/1.0}draftResponse'));
                for (var i = 0; i < bpm_package.children.length; i++) {
                    logger.log("Draft node:" + bpm_package.children[i].nodeRef);
                    bpm_package.children[i].properties['cts:caseStatus'] = 'Draft';
                    if (bpm_package.children[i].properties['cts:caseTask'] != 'Amend response') {
                        bpm_package.children[i].properties['cts:caseTask'] = 'Draft response';
                    }
                    //set owner to admin so that users don't keep edit permissions
                    bpm_package.children[i].setOwner('admin');
                    bpm_package.children[i].properties['cts:caseWorkflowStatus'] = '{"transitions":[{"label":"Reallocate","value":"Reallocate","manualAllocate":true,"allocateHeader":"Reallocate","colour":"green"},{"label":"Submit","value":"SendForQA","manualAllocate":true,"allocateHeader":"Allocate for QA review","colour":"green"},{"label":"Return","value":"Reject","manualAllocate":true,"allocateHeader":"Reject","colour":"red"}],"mandatoryFields":[{"name":"hoCaseOfficer","message":"HO case officer is required"},{"name":"answeringMinister","message":"Sign off Minister must be populated when ministerial sign off is required","expression":"notBlank(case.answeringMinister) or form.foiMinisterSignOff !== 1"},{"name":"pitLetterSentDate","message":"The date of the PIT extension letter must be populated","expression":"notBlank(case.pitLetterSentDate) or form.pitExtension !== 1"},{"name":"pitQualifiedExemptions","message":"An appropriate PIT exemption must be selected","expression":"notEmpty(case.pitQualifiedExemptions) or form.pitExtension !== 1"},{"name":"correspondentForename","message":"First name in the Requestor details on the create page must be populated"},{"name":"correspondentSurname","message":"Last name in the Requestor details on the create page must be populated"},{"name":"document","message":"A document with a Response document type must be uploaded","expression":"case.hasCaseDocument(\'Response\') === true"},{"name":"exemptions","message":"Exemptions in the outcome section must be populated","expression":"notEmpty(case.exemptions) or case.markupDecision !== \'Information withheld in full\' and case.markupDecision !== \'Information released in part\'"}]}';
                    bpm_package.children[i].save();
                }]]></activiti:string>
          </activiti:field>
        </activiti:taskListener>
        <activiti:taskListener event="complete" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[for (var i = 0; i < bpm_package.children.length; i++) {
               if (bpm_package.children[i].properties['cts:markupDecision'] == 'No reply needed') {
                   logger.log("Send initial case for NRR");
                   execution.setVariable('bpm_outcome', 'InitialDraftToNRR');
                   execution.setVariable('cts_nrr_original_status', 'InitialDraftTask');
                   execution.setVariable('cts_nrr_original_create_case_unit', bpm_package.children[i].properties['cts:assignedUnit']);
                   execution.setVariable('cts_nrr_original_create_case_team', bpm_package.children[i].properties['cts:assignedTeam']);
                   execution.setVariable('cts_nrr_original_create_case_user', bpm_package.children[i].properties['cts:assignedUser']);
               } else if (bpm_package.children[i].properties['cts:markupDecision'] == 'Refer to DCU' ||
            	   bpm_package.children[i].properties['cts:markupDecision'] == 'Request unclear') {
                   execution.setVariable('bpm_outcome', 'InitialDraftToComplete');
               }  else if (task.getVariableLocal('cts_draftResponse') == 'Reject'){
                    logger.log("Send initial draft to create case for Misallocated");
                    execution.setVariable('cts_misallocated_case','true')
                    execution.setVariable('bpm_outcome', 'SendToCreate');
               } else{
                   logger.log("Send initial draft for qa review");
                   execution.setVariable('bpm_outcome', 'SendInitialDraftForQaReview');
               }
           }]]></activiti:string>
          </activiti:field>
        </activiti:taskListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow4" sourceRef="InitialDraftTask" targetRef="exclusivegateway2"></sequenceFlow>
    <exclusiveGateway id="exclusivegateway2" name="Exclusive Gateway"></exclusiveGateway>
    <sequenceFlow id="SendForQA" name="SendForQA" sourceRef="exclusivegateway2" targetRef="QAReview">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${(bpm_outcome == 'SendInitialDraftForQaReview')}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="InitialDraftToNRR" sourceRef="exclusivegateway2" targetRef="NRR">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${(bpm_outcome == 'InitialDraftToNRR')}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="InitialDraftToComplete" sourceRef="exclusivegateway2" targetRef="completeWorkflowScript">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${(bpm_outcome == 'InitialDraftToComplete')}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="SendToCreate" name="SendToCreate" sourceRef="exclusivegateway2" targetRef="CreateCaseTask">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${(bpm_outcome == 'SendToCreate')}]]></conditionExpression>
    </sequenceFlow>
    <userTask id="QAReview" name="QA Review" activiti:formKey="wf:adhocTask">
      <extensionElements>
        <activiti:taskListener event="create" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
          <activiti:field name="runAs">
            <activiti:string><![CDATA[admin]]></activiti:string>
          </activiti:field>
          <activiti:field name="script">
            <activiti:string><![CDATA[logger.log("Sending node to QA review");
                task.setVariableLocal('bpm_outcomePropertyName',qn.getQname('{http://cts-beta.homeoffice.gov.uk/model/content/1.0}draftResponse'));
                execution.setVariable('bpm_outcomePropertyName',qn.getQname('{http://cts-beta.homeoffice.gov.uk/model/content/1.0}draftResponse'));
                for (var i = 0; i < bpm_package.children.length; i++) {
                    logger.log("Draft node:" + bpm_package.children[i].nodeRef);
                    bpm_package.children[i].properties['cts:caseStatus'] = 'Draft';
                    bpm_package.children[i].properties['cts:caseTask'] = 'QA review';
                    //set owner to admin so that users don't keep edit permissions
                    bpm_package.children[i].setOwner('admin');
                    bpm_package.children[i].properties['cts:caseWorkflowStatus'] = '{"transitions":[{"label":"Reallocate","value": "Reallocate","manualAllocate": true,"allocateHeader": "Reallocate","colour": "green"},{"label":"Approve","value": "SendForSCSApproval","manualAllocate": true,"allocateHeader": "Allocate for SCS approval","colour": "green"},{"label":"Return","value": "Reject","manualAllocate": false,"allocateHeader": "Reallocate for drafter","colour": "red"}]}';
                    bpm_package.children[i].save();
                }]]></activiti:string>
          </activiti:field>
        </activiti:taskListener>
        <activiti:taskListener event="complete" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[var approved = (task.getVariableLocal('cts_draftResponse') == 'SendForSCSApproval');
                logger.log("task.getVariableLocal="+task.getVariableLocal('cts_draftResponse'));
                logger.log("Sending to SCS="+approved);
                if(approved){
                    execution.setVariable('bpm_outcome', 'SendForSCSApproval');
                }else{
                    logger.log("Returning to Draft response");
                    execution.setVariable('bpm_outcome', 'ReturnDraft');
                    for (var i = 0; i < bpm_package.children.length; i++) {
                        logger.log("Returning node to Draft response:" + bpm_package.children[i].nodeRef);
                        bpm_package.children[i].properties['cts:caseStatus'] = 'Draft';
                        bpm_package.children[i].properties['cts:caseTask'] = 'Amend response';
                        bpm_package.children[i].properties['cts:assignedUnit'] = bpm_package.children[i].properties['cts:originalDrafterUnit'];
                   		bpm_package.children[i].properties['cts:assignedTeam'] = bpm_package.children[i].properties['cts:originalDrafterTeam'];
                    	bpm_package.children[i].properties['cts:assignedUser'] = bpm_package.children[i].properties['cts:originalDrafterUser'];
                        bpm_package.children[i].properties['cts:caseWorkflowStatus'] = '{"transitions":[{"label":"Reallocate","value":"Reallocate","manualAllocate":true,"allocateHeader":"Reallocate","colour":"green"},{"label":"Submit","value":"SendForQA","manualAllocate":true,"allocateHeader":"Allocate for QA review","colour":"green"},{"label":"Return","value":"Reject","manualAllocate":true,"allocateHeader":"Reject","colour":"red"}],"mandatoryFields":[{"name":"hoCaseOfficer","message":"HO case officer is required"},{"name":"answeringMinister","message":"Sign off Minister must be populated when ministerial sign off is required","expression":"notBlank(case.answeringMinister) or form.foiMinisterSignOff !== 1"},{"name":"pitLetterSentDate","message":"The date of the PIT extension letter must be populated","expression":"notBlank(case.pitLetterSentDate) or form.pitExtension !== 1"},{"name":"pitQualifiedExemptions","message":"An appropriate PIT exemption must be selected","expression":"notEmpty(case.pitQualifiedExemptions) or form.pitExtension !== 1"},{"name":"correspondentForename","message":"First name in the Requestor details on the create page must be populated"},{"name":"correspondentSurname","message":"Last name in the Requestor details on the create page must be populated"},{"name":"document","message":"A document with a Response document type must be uploaded","expression":"case.hasCaseDocument(\'Response\') === true"},{"name":"exemptions","message":"Exemptions in the outcome section must be populated","expression":"notEmpty(case.exemptions) or case.markupDecision !== \'Information withheld in full\' and case.markupDecision !== \'Information released in part\'"}]}';
                        bpm_package.children[i].save();
                    }
                }]]></activiti:string>
          </activiti:field>
        </activiti:taskListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="QAReviewComplete" sourceRef="QAReview" targetRef="QAReviewGateway"></sequenceFlow>
    <exclusiveGateway id="QAReviewGateway" name="QA review gateway" default="SendForSCSApproval"></exclusiveGateway>
    <sequenceFlow id="ReturnQAReviewToDraft" name="ReturnQAReviewToDraft" sourceRef="QAReviewGateway" targetRef="InitialDraftTask">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${(bpm_outcome == 'ReturnDraft')}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="SendForSCSApproval" name="SendForSCSApproval" sourceRef="QAReviewGateway" targetRef="SCSApproval"></sequenceFlow>
    <userTask id="SCSApproval" name="SCS Approval" activiti:formKey="wf:adhocTask">
      <extensionElements>
        <activiti:taskListener event="create" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
          <activiti:field name="runAs">
            <activiti:string><![CDATA[admin]]></activiti:string>
          </activiti:field>
          <activiti:field name="script">
            <activiti:string><![CDATA[logger.log("Sending node to SCS Approval;");
                task.setVariableLocal('bpm_outcomePropertyName',qn.getQname('{http://cts-beta.homeoffice.gov.uk/model/content/1.0}draftResponse'));
                execution.setVariable('bpm_outcomePropertyName',qn.getQname('{http://cts-beta.homeoffice.gov.uk/model/content/1.0}draftResponse'));
                for (var i = 0; i < bpm_package.children.length; i++) {
                    logger.log("Draft node:" + bpm_package.children[i].nodeRef);
                    bpm_package.children[i].properties['cts:caseStatus'] = 'Approvals';
                    bpm_package.children[i].properties['cts:caseTask'] = 'SCS approval';
                    //set owner to admin so that users don't keep edit permissions
                    bpm_package.children[i].setOwner('admin');
                    bpm_package.children[i].properties['cts:caseWorkflowStatus'] = '{"transitions":[{"label":"Reallocate","value": "Reallocate","manualAllocate": true,"allocateHeader": "Reallocate","colour": "green"},{"label":"Approve","value": "SendForPressOfficeReview","manualAllocate": false,"allocateHeader": "Allocate for Press Office review","colour": "green"},{"label":"Return","value": "Reject","manualAllocate": false,"allocateHeader": "Reallocate for drafter","colour": "red"}]}';
                    bpm_package.children[i].save();
                }]]></activiti:string>
          </activiti:field>
        </activiti:taskListener>
        <activiti:taskListener event="complete" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[var approved = (task.getVariableLocal('cts_draftResponse') == 'SendForPressOfficeReview');
                logger.log("task.getVariableLocal="+task.getVariableLocal('cts_draftResponse'));
                logger.log("Sending to Press Office="+approved);
                if(approved){
                    execution.setVariable('bpm_outcome', 'SendForPressOfficeReview');
                }else{
                    logger.log("Returning to Draft response");
                    execution.setVariable('bpm_outcome', 'ReturnDraft');
                    for (var i = 0; i < bpm_package.children.length; i++) {
                        logger.log("Returning node to Draft response:" + bpm_package.children[i].nodeRef);
                        bpm_package.children[i].properties['cts:caseStatus'] = 'Draft';
                        bpm_package.children[i].properties['cts:caseTask'] = 'Amend response';
                        bpm_package.children[i].properties['cts:assignedUnit'] = bpm_package.children[i].properties['cts:originalDrafterUnit'];
                        bpm_package.children[i].properties['cts:assignedTeam'] = bpm_package.children[i].properties['cts:originalDrafterTeam'];
                        bpm_package.children[i].properties['cts:assignedUser'] = bpm_package.children[i].properties['cts:originalDrafterUser'];
                        bpm_package.children[i].properties['cts:caseWorkflowStatus'] = '{"transitions":[{"label":"Reallocate","value":"Reallocate","manualAllocate":true,"allocateHeader":"Reallocate","colour":"green"},{"label":"Submit","value":"SendForQA","manualAllocate":true,"allocateHeader":"Allocate for QA review","colour":"green"},{"label":"Return","value":"Reject","manualAllocate":true,"allocateHeader":"Reject","colour":"red"}],"mandatoryFields":[{"name":"hoCaseOfficer","message":"HO case officer is required"},{"name":"answeringMinister","message":"Sign off Minister must be populated when ministerial sign off is required","expression":"notBlank(case.answeringMinister) or form.foiMinisterSignOff !== 1"},{"name":"pitLetterSentDate","message":"The date of the PIT extension letter must be populated","expression":"notBlank(case.pitLetterSentDate) or form.pitExtension !== 1"},{"name":"pitQualifiedExemptions","message":"An appropriate PIT exemption must be selected","expression":"notEmpty(case.pitQualifiedExemptions) or form.pitExtension !== 1"},{"name":"correspondentForename","message":"First name in the Requestor details on the create page must be populated"},{"name":"correspondentSurname","message":"Last name in the Requestor details on the create page must be populated"},{"name":"document","message":"A document with a Response document type must be uploaded","expression":"case.hasCaseDocument(\'Response\') === true"},{"name":"exemptions","message":"Exemptions in the outcome section must be populated","expression":"notEmpty(case.exemptions) or case.markupDecision !== \'Information withheld in full\' and case.markupDecision !== \'Information released in part\'"}]}';
                        bpm_package.children[i].save();
                    }
                }]]></activiti:string>
          </activiti:field>
        </activiti:taskListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="SCSApprovalComplete" sourceRef="SCSApproval" targetRef="SCSApprovalGateway"></sequenceFlow>
    <exclusiveGateway id="SCSApprovalGateway" name="SCS approval gateway" default="SendForPressOfficeReview"></exclusiveGateway>
    <sequenceFlow id="ReturnSCSApprovalToDraft" name="ReturnSCSApprovalToDraft" sourceRef="SCSApprovalGateway" targetRef="InitialDraftTask">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${(bpm_outcome == 'ReturnDraft')}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="SendForPressOfficeReview" name="SendForPressOfficeReview" sourceRef="SCSApprovalGateway" targetRef="PressOfficeReview"></sequenceFlow>
    <userTask id="PressOfficeReview" name="Press Office Review" activiti:formKey="wf:adhocTask">
      <extensionElements>
        <activiti:taskListener event="create" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
          <activiti:field name="runAs">
            <activiti:string><![CDATA[admin]]></activiti:string>
          </activiti:field>
          <activiti:field name="script">
            <activiti:string><![CDATA[logger.log("Sending node to Press Office review;");
                task.setVariableLocal('bpm_outcomePropertyName',qn.getQname('{http://cts-beta.homeoffice.gov.uk/model/content/1.0}draftResponse'));
                execution.setVariable('bpm_outcomePropertyName',qn.getQname('{http://cts-beta.homeoffice.gov.uk/model/content/1.0}draftResponse'));
                for (var i = 0; i < bpm_package.children.length; i++) {
                    logger.log("Draft node:" + bpm_package.children[i].nodeRef);
                    bpm_package.children[i].properties['cts:caseStatus'] = 'Approvals';
                    bpm_package.children[i].properties['cts:caseTask'] = 'Press Office review';
                    bpm_package.children[i].properties['cts:assignedUnit'] = 'GROUP_Capabilities Resources';
                    bpm_package.children[i].properties['cts:assignedTeam'] = 'GROUP_Press Office';
                    bpm_package.children[i].properties['cts:assignedUser'] = null;
                    //set owner to admin so that users don't keep edit permissions
                    bpm_package.children[i].setOwner('admin');
                    bpm_package.children[i].properties['cts:caseWorkflowStatus'] = '{"transitions":[{"label":"Reallocate","value": "Reallocate","manualAllocate": true,"allocateHeader": "Reallocate","colour": "green"},{"label":"Noted","value": "PressOfficeNoted","manualAllocate": false,"allocateHeader": "Allocate","colour": "green"},{"label":"Return","value": "Reject","manualAllocate": false,"allocateHeader": "Rellocate for drafting","colour": "red"}]}';
                    bpm_package.children[i].save();
                }]]></activiti:string>
          </activiti:field>
        </activiti:taskListener>
        <activiti:taskListener event="complete" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[var noted = (task.getVariableLocal('cts_draftResponse') == 'PressOfficeNoted');
                logger.log("task.getVariableLocal="+task.getVariableLocal('cts_draftResponse'));
                if(noted){
                    var notedTransition = "SendForDispatch";
                    for (var i = 0; i < bpm_package.children.length; i++) {
	                    if (bpm_package.children[i].properties['cts:foiMinisterSignOff']) {
	                        notedTransition = "SendForSpadsApproval";
	                    }
	                    logger.log("notedTransition = "+notedTransition);
                    }
                    execution.setVariable('bpm_outcome', notedTransition);
                }else{
                    logger.log("Returning to Draft response");
                    execution.setVariable('bpm_outcome', 'ReturnDraft');
                    for (var i = 0; i < bpm_package.children.length; i++) {
                        logger.log("Returning node to Draft response:" + bpm_package.children[i].nodeRef);
                        bpm_package.children[i].properties['cts:caseStatus'] = 'Draft';
                        bpm_package.children[i].properties['cts:caseTask'] = 'Amend response';
                        bpm_package.children[i].properties['cts:assignedUnit'] = bpm_package.children[i].properties['cts:originalDrafterUnit'];
                        bpm_package.children[i].properties['cts:assignedTeam'] = bpm_package.children[i].properties['cts:originalDrafterTeam'];
                        bpm_package.children[i].properties['cts:assignedUser'] = bpm_package.children[i].properties['cts:originalDrafterUser'];
                        bpm_package.children[i].properties['cts:caseWorkflowStatus'] = '{"transitions":[{"label":"Reallocate","value":"Reallocate","manualAllocate":true,"allocateHeader":"Reallocate","colour":"green"},{"label":"Submit","value":"SendForQA","manualAllocate":true,"allocateHeader":"Allocate for QA review","colour":"green"},{"label":"Return","value":"Reject","manualAllocate":true,"allocateHeader":"Reject","colour":"red"}],"mandatoryFields":[{"name":"hoCaseOfficer","message":"HO case officer is required"},{"name":"answeringMinister","message":"Sign off Minister must be populated when ministerial sign off is required","expression":"notBlank(case.answeringMinister) or form.foiMinisterSignOff !== 1"},{"name":"pitLetterSentDate","message":"The date of the PIT extension letter must be populated","expression":"notBlank(case.pitLetterSentDate) or form.pitExtension !== 1"},{"name":"pitQualifiedExemptions","message":"An appropriate PIT exemption must be selected","expression":"notEmpty(case.pitQualifiedExemptions) or form.pitExtension !== 1"},{"name":"correspondentForename","message":"First name in the Requestor details on the create page must be populated"},{"name":"correspondentSurname","message":"Last name in the Requestor details on the create page must be populated"},{"name":"document","message":"A document with a Response document type must be uploaded","expression":"case.hasCaseDocument(\'Response\') === true"},{"name":"exemptions","message":"Exemptions in the outcome section must be populated","expression":"notEmpty(case.exemptions) or case.markupDecision !== \'Information withheld in full\' and case.markupDecision !== \'Information released in part\'"}]}';
                        bpm_package.children[i].save();
                    }
                }]]></activiti:string>
          </activiti:field>
        </activiti:taskListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="flow1" sourceRef="PressOfficeReview" targetRef="PressOfficeReviewGateway"></sequenceFlow>
    <exclusiveGateway id="PressOfficeReviewGateway" name="Press Office review gateway" default="SendForDispatch"></exclusiveGateway>
    <sequenceFlow id="SendForSpadsApproval" name="SendForSpadsApproval" sourceRef="PressOfficeReviewGateway" targetRef="SpadsApproval">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${(bpm_outcome == 'SendForSpadsApproval')}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="ReturnPressOfficeReviewToDraft" name="ReturnPressOfficeReviewToDraft" sourceRef="PressOfficeReviewGateway" targetRef="InitialDraftTask">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${(bpm_outcome == 'ReturnDraft')}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="SendForDispatch" name="SendForDispatch" sourceRef="PressOfficeReviewGateway" targetRef="Dispatch"></sequenceFlow>
    <userTask id="SpadsApproval" name="Spads Approval" activiti:formKey="wf:adhocTask">
      <extensionElements>
        <activiti:taskListener event="create" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
          <activiti:field name="runAs">
            <activiti:string><![CDATA[admin]]></activiti:string>
          </activiti:field>
          <activiti:field name="script">
            <activiti:string><![CDATA[logger.log("Sending node to minister review");
                task.setVariableLocal('bpm_outcomePropertyName',qn.getQname('{http://cts-beta.homeoffice.gov.uk/model/content/1.0}draftResponse'));
                execution.setVariable('bpm_outcomePropertyName',qn.getQname('{http://cts-beta.homeoffice.gov.uk/model/content/1.0}draftResponse'));
                for (var i = 0; i < bpm_package.children.length; i++) {
                    logger.log("Draft node:" + bpm_package.children[i].nodeRef);
                    bpm_package.children[i].properties['cts:caseStatus'] = 'Approvals';
                    bpm_package.children[i].properties['cts:caseTask'] = 'SpAds approval';
                    bpm_package.children[i].properties['cts:assignedUnit'] = 'GROUP_PO';
                    bpm_package.children[i].properties['cts:assignedTeam'] = 'GROUP_SPADs';
                    bpm_package.children[i].properties['cts:assignedUser'] = null;
                    //set owner to admin so that users don't keep edit permissions
                    bpm_package.children[i].setOwner('admin');
                    bpm_package.children[i].properties['cts:caseWorkflowStatus'] = '{"transitions":[{"label":"Reallocate","value": "Reallocate","manualAllocate": true,"allocateHeader": "Reallocate","colour": "green"},{"label":"Approve","value": "SendForMinisterSignOff","manualAllocate": false,"allocateHeader": "Allocate for Minister sign-off","colour": "green"},{"label":"Return","value": "Reject","manualAllocate": false,"allocateHeader": "Reallocate for drafter","colour": "red"}]}';
                    bpm_package.children[i].save();
                }]]></activiti:string>
          </activiti:field>
        </activiti:taskListener>
        <activiti:taskListener event="complete" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[var approved = (task.getVariableLocal('cts_draftResponse') == 'SendForMinisterSignOff');
                logger.log("task.getVariableLocal="+task.getVariableLocal('cts_draftResponse'));
                logger.log("Sending to SCS="+approved);
                if(approved){
                    execution.setVariable('bpm_outcome', 'SendForMinisterSignOff');
                }else{
                    logger.log("Returning to Draft Response");
                    execution.setVariable('bpm_outcome', 'ReturnDraft');
                    for (var i = 0; i < bpm_package.children.length; i++) {
                        logger.log("Returning node to Draft Response:" + bpm_package.children[i].nodeRef);
                        bpm_package.children[i].properties['cts:caseStatus'] = 'Draft';
                        bpm_package.children[i].properties['cts:caseTask'] = 'Amend response';
                        bpm_package.children[i].properties['cts:assignedUnit'] = bpm_package.children[i].properties['cts:originalDrafterUnit'];
                        bpm_package.children[i].properties['cts:assignedTeam'] = bpm_package.children[i].properties['cts:originalDrafterTeam'];
                        bpm_package.children[i].properties['cts:assignedUser'] = bpm_package.children[i].properties['cts:originalDrafterUser'];
                        bpm_package.children[i].properties['cts:caseWorkflowStatus'] = '{"transitions":[{"label":"Reallocate","value":"Reallocate","manualAllocate":true,"allocateHeader":"Reallocate","colour":"green"},{"label":"Submit","value":"SendForQA","manualAllocate":true,"allocateHeader":"Allocate for QA review","colour":"green"},{"label":"Return","value":"Reject","manualAllocate":true,"allocateHeader":"Reject","colour":"red"}],"mandatoryFields":[{"name":"hoCaseOfficer","message":"HO case officer is required"},{"name":"answeringMinister","message":"Sign off Minister must be populated when ministerial sign off is required","expression":"notBlank(case.answeringMinister) or form.foiMinisterSignOff !== 1"},{"name":"pitLetterSentDate","message":"The date of the PIT extension letter must be populated","expression":"notBlank(case.pitLetterSentDate) or form.pitExtension !== 1"},{"name":"pitQualifiedExemptions","message":"An appropriate PIT exemption must be selected","expression":"notEmpty(case.pitQualifiedExemptions) or form.pitExtension !== 1"},{"name":"correspondentForename","message":"First name in the Requestor details on the create page must be populated"},{"name":"correspondentSurname","message":"Last name in the Requestor details on the create page must be populated"},{"name":"document","message":"A document with a Response document type must be uploaded","expression":"case.hasCaseDocument(\'Response\') === true"},{"name":"exemptions","message":"Exemptions in the outcome section must be populated","expression":"notEmpty(case.exemptions) or case.markupDecision !== \'Information withheld in full\' and case.markupDecision !== \'Information released in part\'"}]}';
                        bpm_package.children[i].save();
                    }
                }]]></activiti:string>
          </activiti:field>
        </activiti:taskListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="SpadsApprovalComplete" sourceRef="SpadsApproval" targetRef="SpadsApprovalGateway"></sequenceFlow>
    <exclusiveGateway id="SpadsApprovalGateway" name="Spads approval gateway" default="SendForMinisterSignOff"></exclusiveGateway>
    <sequenceFlow id="ReturnSpadsApprovalToDraft" name="ReturnSpadsApprovalToDraft" sourceRef="SpadsApprovalGateway" targetRef="InitialDraftTask">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${(bpm_outcome == 'ReturnDraft')}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="SendForMinisterSignOff" name="SendForMinisterSignOff" sourceRef="SpadsApprovalGateway" targetRef="MinisterSignOff"></sequenceFlow>
    <userTask id="MinisterSignOff" name="Minister sign-off" activiti:formKey="wf:adhocTask">
      <extensionElements>
        <activiti:taskListener event="create" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
          <activiti:field name="runAs">
            <activiti:string><![CDATA[admin]]></activiti:string>
          </activiti:field>
          <activiti:field name="script">
            <activiti:string><![CDATA[logger.log("Sending node to SpAds review");
                task.setVariableLocal('bpm_outcomePropertyName',qn.getQname('{http://cts-beta.homeoffice.gov.uk/model/content/1.0}draftResponse'));
                execution.setVariable('bpm_outcomePropertyName',qn.getQname('{http://cts-beta.homeoffice.gov.uk/model/content/1.0}draftResponse'));
                for (var i = 0; i < bpm_package.children.length; i++) {
                    logger.log("Draft node:" + bpm_package.children[i].nodeRef);
                    bpm_package.children[i].properties['cts:caseStatus'] = 'Obtain sign-off';
                    bpm_package.children[i].properties['cts:caseTask'] = 'FOI Minister sign-off';
                    bpm_package.children[i].properties['cts:assignedUnit'] = 'GROUP_Private Office';
                    bpm_package.children[i].properties['cts:assignedTeam'] = 'GROUP_FOI Ministers Private Office';
                    bpm_package.children[i].properties['cts:assignedUser'] = null;
                    //set owner to admin so that users don't keep edit permissions
                    bpm_package.children[i].setOwner('admin');
                    bpm_package.children[i].properties['cts:caseWorkflowStatus'] = '{"transitions":[{"label":"Reallocate","value": "Reallocate","manualAllocate": true,"allocateHeader": "Reallocate","colour": "green"},{"label":"Approve","value": "SendForDispatch","manualAllocate": false,"allocateHeader": "Allocate for dispatch","colour": "green"},{"label":"Return","value": "Reject","manualAllocate": false,"allocateHeader": "Reallocate for drafter","colour": "red"}]}';
                    bpm_package.children[i].save();
                }]]></activiti:string>
          </activiti:field>
        </activiti:taskListener>
        <activiti:taskListener event="complete" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[var approved = (task.getVariableLocal('cts_draftResponse') == 'SendForDispatch');
                logger.log("task.getVariableLocal="+task.getVariableLocal('cts_draftResponse'));
                logger.log("Sending for dispatch="+approved);
                if(approved){
                    execution.setVariable('bpm_outcome', 'SendForDispatch');
                }else{
                    logger.log("Returning to Draft Response");
                    execution.setVariable('bpm_outcome', 'ReturnDraft');
                    for (var i = 0; i < bpm_package.children.length; i++) {
                        logger.log("Returning node to Draft Response:" + bpm_package.children[i].nodeRef);
                        bpm_package.children[i].properties['cts:caseStatus'] = 'Draft';
                        bpm_package.children[i].properties['cts:caseTask'] = 'Amend response';
                        bpm_package.children[i].properties['cts:assignedUnit'] = bpm_package.children[i].properties['cts:originalDrafterUnit'];
                        bpm_package.children[i].properties['cts:assignedTeam'] = bpm_package.children[i].properties['cts:originalDrafterTeam'];
                        bpm_package.children[i].properties['cts:assignedUser'] = bpm_package.children[i].properties['cts:originalDrafterUser'];
                        bpm_package.children[i].properties['cts:caseWorkflowStatus'] = '{"transitions":[{"label":"Reallocate","value":"Reallocate","manualAllocate":true,"allocateHeader":"Reallocate","colour":"green"},{"label":"Submit","value":"SendForQA","manualAllocate":true,"allocateHeader":"Allocate for QA review","colour":"green"},{"label":"Return","value":"Reject","manualAllocate":true,"allocateHeader":"Reject","colour":"red"}],"mandatoryFields":[{"name":"hoCaseOfficer","message":"HO case officer is required"},{"name":"answeringMinister","message":"Sign off Minister must be populated when ministerial sign off is required","expression":"notBlank(case.answeringMinister) or form.foiMinisterSignOff !== 1"},{"name":"pitLetterSentDate","message":"The date of the PIT extension letter must be populated","expression":"notBlank(case.pitLetterSentDate) or form.pitExtension !== 1"},{"name":"pitQualifiedExemptions","message":"An appropriate PIT exemption must be selected","expression":"notEmpty(case.pitQualifiedExemptions) or form.pitExtension !== 1"},{"name":"correspondentForename","message":"First name in the Requestor details on the create page must be populated"},{"name":"correspondentSurname","message":"Last name in the Requestor details on the create page must be populated"},{"name":"document","message":"A document with a Response document type must be uploaded","expression":"case.hasCaseDocument(\'Response\') === true"},{"name":"exemptions","message":"Exemptions in the outcome section must be populated","expression":"notEmpty(case.exemptions) or case.markupDecision !== \'Information withheld in full\' and case.markupDecision !== \'Information released in part\'"}]}';
                        bpm_package.children[i].save();
                    }
                }]]></activiti:string>
          </activiti:field>
        </activiti:taskListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="MinisterSignOffComplete" sourceRef="MinisterSignOff" targetRef="MinisterSignOffGateway">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${(bpm_outcome == 'SendForDispatch')}]]></conditionExpression>
    </sequenceFlow>
    <exclusiveGateway id="MinisterSignOffGateway" name="Minister sign off gateway" default="SendForDispatch2"></exclusiveGateway>
    <sequenceFlow id="ReturnMinisterSignOffToDraft" name="ReturnMinisterSignOffToDraft" sourceRef="MinisterSignOffGateway" targetRef="InitialDraftTask">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${(bpm_outcome == 'ReturnDraft')}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="SendForDispatch2" name="SendForDispatch2" sourceRef="MinisterSignOffGateway" targetRef="Dispatch"></sequenceFlow>
    <userTask id="Dispatch" name="Dispatch" activiti:formKey="wf:adhocTask">
      <extensionElements>
        <activiti:taskListener event="create" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
          <activiti:field name="runAs">
            <activiti:string><![CDATA[admin]]></activiti:string>
          </activiti:field>
          <activiti:field name="script">
            <activiti:string><![CDATA[logger.log("Sending node to Press Office review;");
                task.setVariableLocal('bpm_outcomePropertyName',qn.getQname('{http://cts-beta.homeoffice.gov.uk/model/content/1.0}draftResponse'));
                execution.setVariable('bpm_outcomePropertyName',qn.getQname('{http://cts-beta.homeoffice.gov.uk/model/content/1.0}draftResponse'));
                for (var i = 0; i < bpm_package.children.length; i++) {
                    logger.log("Draft node:" + bpm_package.children[i].nodeRef);
                    bpm_package.children[i].properties['cts:caseStatus'] = 'Dispatch';
                    bpm_package.children[i].properties['cts:caseTask'] = 'Dispatch response';
                    //set owner to admin so that users don't keep edit permissions
                    bpm_package.children[i].setOwner('admin');
                    bpm_package.children[i].properties['cts:caseWorkflowStatus'] = '{"transitions":[{"label":"Reallocate","value": "Reallocate","manualAllocate": true,"allocateHeader": "Reallocate","colour": "green"},{"label":"Dispatch","value": "Next","manualAllocate": false, "allocateHeader": "","colour": "green"},{"label":"Return","value": "Reject","manualAllocate": false,"allocateHeader": "Rellocate for drafting","colour": "red"}]}';
                    bpm_package.children[i].properties['cts:assignedUnit'] = bpm_package.children[i].properties['cts:originalDrafterUnit'];
                    bpm_package.children[i].properties['cts:assignedTeam'] = bpm_package.children[i].properties['cts:originalDrafterTeam'];
                    bpm_package.children[i].properties['cts:assignedUser'] = bpm_package.children[i].properties['cts:originalDrafterUser'];
                    bpm_package.children[i].save();
                }]]></activiti:string>
          </activiti:field>
        </activiti:taskListener>
        <activiti:taskListener event="complete" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
          <activiti:field name="runAs">
            <activiti:string><![CDATA[admin]]></activiti:string>
          </activiti:field>
          <activiti:field name="script">
            <activiti:string><![CDATA[for (var i = 0; i < bpm_package.children.length; i++) {
	            if (task.getVariableLocal('cts_draftResponse') == 'Reject') {
	            	 logger.log("Returning to Draft response");
	                 execution.setVariable('bpm_outcome', 'ReturnDraft');
	                 logger.log("Returning node to Draft response:" + bpm_package.children[i].nodeRef);
	                 bpm_package.children[i].properties['cts:caseStatus'] = 'Draft';
	                 bpm_package.children[i].properties['cts:caseTask'] = 'Amend response';
	                 bpm_package.children[i].properties['cts:assignedUnit'] = bpm_package.children[i].properties['cts:originalDrafterUnit'];
	                 bpm_package.children[i].properties['cts:assignedTeam'] = bpm_package.children[i].properties['cts:originalDrafterTeam'];
	                 bpm_package.children[i].properties['cts:assignedUser'] = bpm_package.children[i].properties['cts:originalDrafterUser'];
	                 bpm_package.children[i].properties['cts:caseWorkflowStatus'] = '{"transitions":[{"label":"Reallocate","value":"Reallocate","manualAllocate":true,"allocateHeader":"Reallocate","colour":"green"},{"label":"Submit","value":"SendForQA","manualAllocate":true,"allocateHeader":"Allocate for QA review","colour":"green"},{"label":"Return","value":"Reject","manualAllocate":true,"allocateHeader":"Reject","colour":"red"}],"mandatoryFields":[{"name":"hoCaseOfficer","message":"HO case officer is required"},{"name":"answeringMinister","message":"Sign off Minister must be populated when ministerial sign off is required","expression":"notBlank(case.answeringMinister) or form.foiMinisterSignOff !== 1"},{"name":"pitLetterSentDate","message":"The date of the PIT extension letter must be populated","expression":"notBlank(case.pitLetterSentDate) or form.pitExtension !== 1"},{"name":"pitQualifiedExemptions","message":"An appropriate PIT exemption must be selected","expression":"notEmpty(case.pitQualifiedExemptions) or form.pitExtension !== 1"},{"name":"correspondentForename","message":"First name in the Requestor details on the create page must be populated"},{"name":"correspondentSurname","message":"Last name in the Requestor details on the create page must be populated"},{"name":"document","message":"A document with a Response document type must be uploaded","expression":"case.hasCaseDocument(\'Response\') === true"},{"name":"exemptions","message":"Exemptions in the outcome section must be populated","expression":"notEmpty(case.exemptions) or case.markupDecision !== \'Information withheld in full\' and case.markupDecision !== \'Information released in part\'"}]}';
	                 bpm_package.children[i].save();
               	}
            }]]></activiti:string>
          </activiti:field>
        </activiti:taskListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="DispatchComplete" sourceRef="Dispatch" targetRef="DispatchGateway"></sequenceFlow>
    <exclusiveGateway id="DispatchGateway" name="Dispatch Gateway" default="_2"></exclusiveGateway>
    <sequenceFlow id="ReturnDispatchToDraft" name="Return Dispatch To Draft" sourceRef="DispatchGateway" targetRef="InitialDraftTask">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${(bpm_outcome == 'ReturnDraft')}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="_2" name="End" sourceRef="DispatchGateway" targetRef="completeWorkflowScript"></sequenceFlow>
    <endEvent id="endevent1" name="End"></endEvent>
    <userTask id="NRR" name="No Response Required" activiti:formKey="wf:adhocTask">
      <extensionElements>
        <activiti:taskListener event="create" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
          <activiti:field name="runAs">
            <activiti:string><![CDATA[admin]]></activiti:string>
          </activiti:field>
          <activiti:field name="script">
            <activiti:string><![CDATA[logger.log("Sending node to NRR");
                task.setVariableLocal('bpm_outcomePropertyName',qn.getQname('{http://cts-beta.homeoffice.gov.uk/model/content/1.0}draftResponse'));
                execution.setVariable('bpm_outcomePropertyName',qn.getQname('{http://cts-beta.homeoffice.gov.uk/model/content/1.0}draftResponse'));
                for (var i = 0; i < bpm_package.children.length; i++) {
                    if (bpm_package.children[i].properties['cts:markupDecision'] == 'No reply needed') {
                    	logger.log("NFA Approve node:" + bpm_package.children[i].nodeRef);
	                    bpm_package.children[i].properties['cts:caseStatus'] = 'NFA';
	                    bpm_package.children[i].properties['cts:caseTask'] = 'QA';
	                    bpm_package.children[i].properties['cts:caseWorkflowStatus'] = '{"transitions":[{"label":"Reallocate","value": "Reallocate","manualAllocate": true,"allocateHeader": "Reallocate","colour": "green"},{"label":"Approve","value": "ApproveNRR","manualAllocate": false, "allocateHeader": "","colour": "green"},{"label":"Return","value": "Reject","manualAllocate": false,"allocateHeader": "Return case","colour": "red"}]}';
                    }
                   	bpm_package.children[i].properties['cts:assignedUnit'] = 'GROUP_FOI';
                   	bpm_package.children[i].properties['cts:assignedTeam'] = 'GROUP_FOI_IRT';
                   	bpm_package.children[i].properties['cts:assignedUser'] = null;
                    //set owner to admin so that users don't keep edit permissions
                    bpm_package.children[i].setOwner('admin');
                    bpm_package.children[i].save();
                }]]></activiti:string>
          </activiti:field>
        </activiti:taskListener>
        <activiti:taskListener event="complete" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
          <activiti:field name="script">
            <activiti:string><![CDATA[var approved = (task.getVariableLocal('cts_draftResponse') == 'ApproveNRR');
	                logger.log("task.getVariableLocal="+task.getVariableLocal('cts_draftResponse'));
	                logger.log("Sending to complete from Approve NRR="+approved);
	                if(!approved){
	                    //Work out where to return to
	                    if (execution.getVariable('cts_nrr_original_status') == 'CreateCase') {
       	                    logger.log("Returning to inital case response");
                    		execution.setVariable('bpm_outcome', 'ReturnNRRToCreateCase');
                    		for (var i = 0; i < bpm_package.children.length; i++) {
	                    		bpm_package.children[i].properties['cts:assignedUnit'] = execution.getVariable('cts_nrr_original_create_case_unit');
		                        bpm_package.children[i].properties['cts:assignedTeam'] = execution.getVariable('cts_nrr_original_create_case_team');
			                    bpm_package.children[i].properties['cts:assignedUser'] = execution.getVariable('cts_nrr_original_create_case_user');
	                          	bpm_package.children[i].properties['cts:markupDecision'] = null;
                          	}
                   		} else if (execution.getVariableLocal('cts_nrr_original_status') == 'InitialDraftTask') {
                    		logger.log("Returning to draft response");
                    		execution.setVariable('bpm_outcome', 'ReturnNRRToInitialDraft');
		                    for (var i = 0; i < bpm_package.children.length; i++) {
		                        logger.log("Returning node to Draft response:" + bpm_package.children[i].nodeRef);
		                        bpm_package.children[i].properties['cts:caseStatus'] = 'Draft';
		                        bpm_package.children[i].properties['cts:caseTask'] = 'Amend response';
		                        bpm_package.children[i].properties['cts:assignedUnit'] = bpm_package.children[i].properties['cts:originalDrafterUnit'];
		                        bpm_package.children[i].properties['cts:assignedTeam'] = bpm_package.children[i].properties['cts:originalDrafterTeam'];
		                        bpm_package.children[i].properties['cts:assignedUser'] = bpm_package.children[i].properties['cts:originalDrafterUser'];
		                        bpm_package.children[i].properties['cts:caseWorkflowStatus'] = '{"transitions":[{"label":"Reallocate","value":"Reallocate","manualAllocate":true,"allocateHeader":"Reallocate","colour":"green"},{"label":"Submit","value":"SendForQA","manualAllocate":true,"allocateHeader":"Allocate for QA review","colour":"green"},{"label":"Return","value":"Reject","manualAllocate":true,"allocateHeader":"Reject","colour":"red"}],"mandatoryFields":[{"name":"hmpoResponse","message":"Response Channel is required"},{"name":"hoCaseOfficer","message":"Case Officer is required"}]}';
                               	bpm_package.children[i].properties['cts:markupDecision'] = null;
		                        bpm_package.children[i].save();
		                    }
		                 }
	                }]]></activiti:string>
          </activiti:field>
        </activiti:taskListener>
      </extensionElements>
    </userTask>
    <sequenceFlow id="NRRComplete" sourceRef="NRR" targetRef="NRRGateway"></sequenceFlow>
    <exclusiveGateway id="NRRGateway" name="NRR Approve Gateway" default="_3"></exclusiveGateway>
    <sequenceFlow id="ReturnNRRToInitialDraft" name="Return NRR Approve To Initial Draft" sourceRef="NRRGateway" targetRef="InitialDraftTask">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${(bpm_outcome == 'ReturnNRRToInitialDraft')}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="ReturnNRRToICreateCase" name="Return NRR Approve To Create Case" sourceRef="NRRGateway" targetRef="CreateCaseTask">
      <conditionExpression xsi:type="tFormalExpression"><![CDATA[${(bpm_outcome == 'ReturnNRRToCreateCase')}]]></conditionExpression>
    </sequenceFlow>
    <sequenceFlow id="_3" name="End" sourceRef="NRRGateway" targetRef="completeWorkflowScript"></sequenceFlow>
    <sequenceFlow id="flow2" sourceRef="completeWorkflowScript" targetRef="endevent1"></sequenceFlow>
    <serviceTask id="completeWorkflowScript" name="Complete Workflow" activiti:class="org.alfresco.repo.workflow.activiti.script.AlfrescoScriptDelegate">
      <extensionElements>
        <activiti:field name="script">
          <activiti:string><![CDATA[logger.log("Completing Workflow");
				for (var i = 0 ; i < bpm_package.children.length; i++) {
					logger.log("New node:" + bpm_package.children[i].nodeRef);
					bpm_package.children[i].properties['cts:caseStatus'] = 'Completed';
					bpm_package.children[i].properties['cts:caseTask'] = 'None';
					bpm_package.children[i].properties['cts:assignedUser'] = null;
					bpm_package.children[i].properties['cts:assignedTeam'] = null;
					bpm_package.children[i].properties['cts:assignedUnit'] = null;
					bpm_package.children[i].properties['cts:caseWorkflowStatus'] = null;
					bpm_package.children[i].save();
				}]]></activiti:string>
        </activiti:field>
      </extensionElements>
    </serviceTask>
  </process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_foi_process">
    <bpmndi:BPMNPlane bpmnElement="foi_process" id="BPMNPlane_foi_process">
      <bpmndi:BPMNShape bpmnElement="startevent1" id="BPMNShape_startevent1">
        <omgdc:Bounds height="35.0" width="35.0" x="433.0" y="-135.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="CreateCaseTask" id="BPMNShape_CreateCaseTask">
        <omgdc:Bounds height="55.0" width="105.0" x="398.0" y="-30.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway1" id="BPMNShape_exclusivegateway1">
        <omgdc:Bounds height="40.0" width="40.0" x="430.0" y="39.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="InitialDraftTask" id="BPMNShape_InitialDraftTask">
        <omgdc:Bounds height="55.0" width="105.0" x="398.0" y="115.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="exclusivegateway2" id="BPMNShape_exclusivegateway2">
        <omgdc:Bounds height="40.0" width="40.0" x="430.0" y="189.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="QAReview" id="BPMNShape_QAReview">
        <omgdc:Bounds height="55.0" width="105.0" x="398.0" y="240.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="QAReviewGateway" id="BPMNShape_QAReviewGateway">
        <omgdc:Bounds height="32.0" width="32.0" x="430.0" y="345.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="SCSApproval" id="BPMNShape_SCSApproval">
        <omgdc:Bounds height="55.0" width="105.0" x="398.0" y="452.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="SCSApprovalGateway" id="BPMNShape_SCSApprovalGateway">
        <omgdc:Bounds height="32.0" width="32.0" x="430.0" y="561.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="PressOfficeReview" id="BPMNShape_PressOfficeReview">
        <omgdc:Bounds height="55.0" width="105.0" x="398.0" y="670.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="PressOfficeReviewGateway" id="BPMNShape_PressOfficeReviewGateway">
        <omgdc:Bounds height="40.0" width="40.0" x="430.0" y="780.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="SpadsApproval" id="BPMNShape_SpadsApproval">
        <omgdc:Bounds height="55.0" width="105.0" x="398.0" y="910.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="SpadsApprovalGateway" id="BPMNShape_SpadsApprovalGateway">
        <omgdc:Bounds height="40.0" width="40.0" x="430.0" y="1050.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="MinisterSignOff" id="BPMNShape_MinisterSignOff">
        <omgdc:Bounds height="55.0" width="105.0" x="398.0" y="1188.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="MinisterSignOffGateway" id="BPMNShape_MinisterSignOffGateway">
        <omgdc:Bounds height="40.0" width="40.0" x="430.0" y="1290.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="Dispatch" id="BPMNShape_Dispatch">
        <omgdc:Bounds height="55.0" width="105.0" x="398.0" y="1420.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="DispatchGateway" id="BPMNShape_DispatchGateway">
        <omgdc:Bounds height="40.0" width="40.0" x="430.0" y="1521.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="endevent1" id="BPMNShape_endevent1">
        <omgdc:Bounds height="35.0" width="35.0" x="433.0" y="1680.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="NRR" id="BPMNShape_NRR">
        <omgdc:Bounds height="55.0" width="105.0" x="960.0" y="90.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="NRRGateway" id="BPMNShape_NRRGateway">
        <omgdc:Bounds height="40.0" width="40.0" x="992.0" y="211.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="completeWorkflowScript" id="BPMNShape_completeWorkflowScript">
        <omgdc:Bounds height="55.0" width="105.0" x="398.0" y="1600.0"></omgdc:Bounds>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge bpmnElement="start" id="BPMNEdge_start">
        <omgdi:waypoint x="450.0" y="-100.0"></omgdi:waypoint>
        <omgdi:waypoint x="450.0" y="-30.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="14.0" width="23.0" x="475.0" y="-124.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow3" id="BPMNEdge_flow3">
        <omgdi:waypoint x="450.0" y="25.0"></omgdi:waypoint>
        <omgdi:waypoint x="450.0" y="39.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="CreateCaseToNRR" id="BPMNEdge_CreateCaseToNRR">
        <omgdi:waypoint x="470.0" y="59.0"></omgdi:waypoint>
        <omgdi:waypoint x="1012.0" y="90.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="42.0" width="100.0" x="480.0" y="59.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="CreateCaseToComplete" id="BPMNEdge_CreateCaseToComplete">
        <omgdi:waypoint x="450.0" y="39.0"></omgdi:waypoint>
        <omgdi:waypoint x="253.0" y="-3.0"></omgdi:waypoint>
        <omgdi:waypoint x="253.0" y="818.0"></omgdi:waypoint>
        <omgdi:waypoint x="253.0" y="1224.0"></omgdi:waypoint>
        <omgdi:waypoint x="253.0" y="1627.0"></omgdi:waypoint>
        <omgdi:waypoint x="398.0" y="1627.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="AllocateForDraft" id="BPMNEdge_AllocateForDraft">
        <omgdi:waypoint x="450.0" y="79.0"></omgdi:waypoint>
        <omgdi:waypoint x="450.0" y="115.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="14.0" width="79.0" x="382.0" y="89.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow4" id="BPMNEdge_flow4">
        <omgdi:waypoint x="450.0" y="170.0"></omgdi:waypoint>
        <omgdi:waypoint x="450.0" y="189.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="SendToCreate" id="BPMNEdge_SendToCreate">
        <omgdi:waypoint x="430.0" y="341.0"></omgdi:waypoint>
        <omgdi:waypoint x="262.0" y="205.0"></omgdi:waypoint>
        <omgdi:waypoint x="262.0" y="0.0"></omgdi:waypoint>
        <omgdi:waypoint x="398.0" y="310.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="12.0" width="100.0" x="262.0" y="205.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="SendForQA" id="BPMNEdge_SendForQA">
        <omgdi:waypoint x="430.0" y="209.0"></omgdi:waypoint>
        <omgdi:waypoint x="450.0" y="240.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="14.0" width="57.0" x="447.0" y="204.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="InitialDraftToNRR" id="BPMNEdge_InitialDraftToNRR">
        <omgdi:waypoint x="450.0" y="189.0"></omgdi:waypoint>
        <omgdi:waypoint x="1012.0" y="145.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="InitialDraftToComplete" id="BPMNEdge_InitialDraftToComplete">
        <omgdi:waypoint x="430.0" y="209.0"></omgdi:waypoint>
        <omgdi:waypoint x="255.0" y="232.0"></omgdi:waypoint>
        <omgdi:waypoint x="255.0" y="1263.0"></omgdi:waypoint>
        <omgdi:waypoint x="255.0" y="1444.0"></omgdi:waypoint>
        <omgdi:waypoint x="255.0" y="1627.0"></omgdi:waypoint>
        <omgdi:waypoint x="398.0" y="1627.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="QAReviewComplete" id="BPMNEdge_QAReviewComplete">
        <omgdi:waypoint x="450.0" y="295.0"></omgdi:waypoint>
        <omgdi:waypoint x="446.0" y="345.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="ReturnQAReviewToDraft" id="BPMNEdge_ReturnQAReviewToDraft">
        <omgdi:waypoint x="462.0" y="361.0"></omgdi:waypoint>
        <omgdi:waypoint x="577.0" y="365.0"></omgdi:waypoint>
        <omgdi:waypoint x="577.0" y="142.0"></omgdi:waypoint>
        <omgdi:waypoint x="503.0" y="142.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="42.0" width="100.0" x="470.0" y="330.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="SendForSCSApproval" id="BPMNEdge_SendForSCSApproval">
        <omgdi:waypoint x="446.0" y="377.0"></omgdi:waypoint>
        <omgdi:waypoint x="450.0" y="452.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="42.0" width="100.0" x="455.0" y="400.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="SCSApprovalComplete" id="BPMNEdge_SCSApprovalComplete">
        <omgdi:waypoint x="450.0" y="507.0"></omgdi:waypoint>
        <omgdi:waypoint x="446.0" y="561.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="ReturnSCSApprovalToDraft" id="BPMNEdge_ReturnSCSApprovalToDraft">
        <omgdi:waypoint x="462.0" y="577.0"></omgdi:waypoint>
        <omgdi:waypoint x="577.0" y="581.0"></omgdi:waypoint>
        <omgdi:waypoint x="577.0" y="365.0"></omgdi:waypoint>
        <omgdi:waypoint x="577.0" y="142.0"></omgdi:waypoint>
        <omgdi:waypoint x="503.0" y="142.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="42.0" width="100.0" x="470.0" y="540.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="SendForPressOfficeReview" id="BPMNEdge_SendForPressOfficeReview">
        <omgdi:waypoint x="446.0" y="593.0"></omgdi:waypoint>
        <omgdi:waypoint x="450.0" y="670.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="42.0" width="100.0" x="455.0" y="620.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow1" id="BPMNEdge_flow1">
        <omgdi:waypoint x="450.0" y="725.0"></omgdi:waypoint>
        <omgdi:waypoint x="450.0" y="780.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="SendForSpadsApproval" id="BPMNEdge_SendForSpadsApproval">
        <omgdi:waypoint x="450.0" y="820.0"></omgdi:waypoint>
        <omgdi:waypoint x="450.0" y="910.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="42.0" width="100.0" x="460.0" y="820.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="ReturnPressOfficeReviewToDraft" id="BPMNEdge_ReturnPressOfficeReviewToDraft">
        <omgdi:waypoint x="470.0" y="800.0"></omgdi:waypoint>
        <omgdi:waypoint x="693.0" y="800.0"></omgdi:waypoint>
        <omgdi:waypoint x="693.0" y="474.0"></omgdi:waypoint>
        <omgdi:waypoint x="693.0" y="142.0"></omgdi:waypoint>
        <omgdi:waypoint x="503.0" y="142.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="42.0" width="100.0" x="474.0" y="760.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="SendForDispatch" id="BPMNEdge_SendForDispatch">
        <omgdi:waypoint x="430.0" y="800.0"></omgdi:waypoint>
        <omgdi:waypoint x="297.0" y="800.0"></omgdi:waypoint>
        <omgdi:waypoint x="297.0" y="1002.0"></omgdi:waypoint>
        <omgdi:waypoint x="297.0" y="1447.0"></omgdi:waypoint>
        <omgdi:waypoint x="398.0" y="1447.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="14.0" width="83.0" x="331.0" y="780.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="SpadsApprovalComplete" id="BPMNEdge_SpadsApprovalComplete">
        <omgdi:waypoint x="450.0" y="965.0"></omgdi:waypoint>
        <omgdi:waypoint x="450.0" y="1050.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="ReturnSpadsApprovalToDraft" id="BPMNEdge_ReturnSpadsApprovalToDraft">
        <omgdi:waypoint x="470.0" y="1070.0"></omgdi:waypoint>
        <omgdi:waypoint x="794.0" y="1070.0"></omgdi:waypoint>
        <omgdi:waypoint x="794.0" y="142.0"></omgdi:waypoint>
        <omgdi:waypoint x="503.0" y="142.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="42.0" width="100.0" x="474.0" y="1026.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="SendForMinisterSignOff" id="BPMNEdge_SendForMinisterSignOff">
        <omgdi:waypoint x="450.0" y="1090.0"></omgdi:waypoint>
        <omgdi:waypoint x="450.0" y="1188.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="42.0" width="100.0" x="458.0" y="1109.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="MinisterSignOffComplete" id="BPMNEdge_MinisterSignOffComplete">
        <omgdi:waypoint x="450.0" y="1243.0"></omgdi:waypoint>
        <omgdi:waypoint x="450.0" y="1290.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="ReturnMinisterSignOffToDraft" id="BPMNEdge_ReturnMinisterSignOffToDraft">
        <omgdi:waypoint x="470.0" y="1310.0"></omgdi:waypoint>
        <omgdi:waypoint x="843.0" y="1310.0"></omgdi:waypoint>
        <omgdi:waypoint x="839.0" y="142.0"></omgdi:waypoint>
        <omgdi:waypoint x="503.0" y="142.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="42.0" width="100.0" x="474.0" y="1261.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="SendForDispatch2" id="BPMNEdge_SendForDispatch2">
        <omgdi:waypoint x="450.0" y="1330.0"></omgdi:waypoint>
        <omgdi:waypoint x="450.0" y="1420.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="14.0" width="89.0" x="459.0" y="1366.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="DispatchComplete" id="BPMNEdge_DispatchComplete">
        <omgdi:waypoint x="450.0" y="1475.0"></omgdi:waypoint>
        <omgdi:waypoint x="450.0" y="1521.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="ReturnDispatchToDraft" id="BPMNEdge_ReturnDispatchToDraft">
        <omgdi:waypoint x="470.0" y="1541.0"></omgdi:waypoint>
        <omgdi:waypoint x="907.0" y="1541.0"></omgdi:waypoint>
        <omgdi:waypoint x="907.0" y="142.0"></omgdi:waypoint>
        <omgdi:waypoint x="503.0" y="142.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="42.0" width="100.0" x="480.0" y="1541.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="_2" id="BPMNEdge__2">
        <omgdi:waypoint x="450.0" y="1561.0"></omgdi:waypoint>
        <omgdi:waypoint x="450.0" y="1600.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="14.0" width="0.0" x="450.0" y="1561.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="NRRComplete" id="BPMNEdge_NRRComplete">
        <omgdi:waypoint x="1012.0" y="145.0"></omgdi:waypoint>
        <omgdi:waypoint x="1012.0" y="211.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="ReturnNRRToInitialDraft" id="BPMNEdge_ReturnNRRToInitialDraft">
        <omgdi:waypoint x="1012.0" y="211.0"></omgdi:waypoint>
        <omgdi:waypoint x="450.0" y="170.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="42.0" width="100.0" x="931.0" y="161.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="ReturnNRRToICreateCase" id="BPMNEdge_ReturnNRRToICreateCase">
        <omgdi:waypoint x="1032.0" y="231.0"></omgdi:waypoint>
        <omgdi:waypoint x="1090.0" y="231.0"></omgdi:waypoint>
        <omgdi:waypoint x="1090.0" y="-3.0"></omgdi:waypoint>
        <omgdi:waypoint x="503.0" y="-3.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="42.0" width="100.0" x="979.0" y="8.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="_3" id="BPMNEdge__3">
        <omgdi:waypoint x="1012.0" y="251.0"></omgdi:waypoint>
        <omgdi:waypoint x="1012.0" y="1627.0"></omgdi:waypoint>
        <omgdi:waypoint x="503.0" y="1627.0"></omgdi:waypoint>
        <bpmndi:BPMNLabel>
          <omgdc:Bounds height="14.0" width="18.0" x="458.0" y="1668.0"></omgdc:Bounds>
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="flow2" id="BPMNEdge_flow2">
        <omgdi:waypoint x="450.0" y="1655.0"></omgdi:waypoint>
        <omgdi:waypoint x="450.0" y="1680.0"></omgdi:waypoint>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>
